USE Aeroporto;

CREATE TABLE Passageiro(
NUM_CPF INT PRIMARY KEY,
NOM_PASSAGEIRO VARCHAR(50) NOT NULL
);

CREATE TABLE Voo(
COD_VOO INT PRIMARY KEY,
DES_VOO VARCHAR(50) NOT NULL,
HOR_VOO TIME NOT NULL,
COD_PLATAFORMA VARCHAR(30) NOT NULL,
DES_DESTINO VARCHAR(100) NOT NULL,
NOM_AVIAO VARCHAR(30) NOT NULL,
FOREIGN KEY (NOM_AVIAO) REFERENCES Aviao(NOM_AVIAO)
);

CREATE TABLE Aviao(
NOM_AVIAO VARCHAR(30) PRIMARY KEY,
NUM_QTD_MAX_PASSAGEIROS INT NOT NULL,
NUM_QTD_TRIPULACAO INT NOT NULL,
DES_CATEGORIA VENUM('1a Classe', '2a Classe', 'Transporte') NOT NULL,
NUM_PESO_MAX INT NOT NULL,
DES_EMPRESA_MANUTENCAO VARCHAR(100) NOT NULL
);

CREATE TABLE Bagagens(
NUM_COD_REGISTRO INT PRIMARY KEY AUTO_INCREMENT,
NOM_PASSAGEIRO VARCHAR(50) NOT NULL,
FOREIGN KEY (NOM_PASSAGEIRO) REFERENCES Passageiro(NOM_PASSAGEIRO),
COD_VOO INT NOT NULL,
FOREIGN KEY (COD_VOO) REFERENCES Voo(COD_VOO),
COD_BAGAGEM VARCHAR(30) NOT NULL,
NUM_PESO INT NOT NULL
);

CREATE TABLE Bagagens(
NUM_COD_REGISTRO INT PRIMARY KEY AUTO_INCREMENT,
COD_CPF INT NOT NULL,
FOREIGN KEY (NUM_CPF) REFERENCES Voo(NUM_CPF),
COD_VOO INT NOT NULL,
FOREIGN KEY (COD_VOO) REFERENCES Voo(COD_VOO),
COD_BAGAGEM VARCHAR(30) NOT NULL,
NUM_PESO INT NOT NULL
);

INSERT INTO Passageiro(COD_CPF, NOM_PASSAGEIRO) VALUES (123456781, 'teste1');
INSERT INTO Passageiro(COD_CPF, NOM_PASSAGEIRO) VALUES (123456782, 'teste2');
INSERT INTO Passageiro(COD_CPF, NOM_PASSAGEIRO) VALUES (123456783, 'teste3');
INSERT INTO Passageiro(COD_CPF, NOM_PASSAGEIRO) VALUES (123456784, 'teste4');

INSERT INTO Voo(COD_VOO, DES_VOO, HOR_VOO, COD_PLATAFORMA, DES_DESTINO) VALUES (1, 'BOING 737 GR1T0', 13, 'U38', 'Brasília', 'BOING 737 GR1T0');
INSERT INTO Voo(COD_VOO, DES_VOO, HOR_VOO, COD_PLATAFORMA, DES_DESTINO) VALUES (2, 'BOING 737 QU3DA', 16, 'U38', 'Atlântico', 'BOING 737 GR1T0');

INSERT INTO Aviao(NOM_AVIAO, NUM_QTD_MAX_PASSAGEIROS, NUM_QTD_TRIPULACAO, DES_CATEGORIA, NUM_PESO_MAX, DES_EMPRESA_MANUTENCAO) 
VALUES ('BOING 737 GR1T0', 10, 5, '2a Classe', 100, 'Funerária Ajato');

INSERT INTO Bagagens(COD_VOO, COD_BAGAGEM, NUM_PESO, NUM_CPF) 
VALUES (1, 'P3RDA', 13, 123456781);
INSERT INTO Bagagens(COD_VOO, COD_BAGAGEM, NUM_PESO, NUM_CPF) 
VALUES (1, 'P3RDA', 13, 123456782);
INSERT INTO Bagagens(COD_VOO, COD_BAGAGEM, NUM_PESO, NUM_CPF) 
VALUES (1, 'SUM1U', 23, 123456783);
INSERT INTO Bagagens(COD_VOO, COD_BAGAGEM, NUM_PESO, NUM_CPF) 
VALUES (1, 'CA1U', 28, 123456784);

SELECT COUNT(DISTINCT NUM_CPF) FROM Bagagens;

SELECT Voo.COD_VOO, Aviao.NUM_PESO_MAX, SUM(Bagagens.NUM_PESO) FROM Bagagens, Aviao, Voo 
WHERE Bagagens.COD_VOO = Voo.COD_VOO AND Voo.NOM_AVIAO = Aviao.NOM_AVIAO
GROUP BY Voo.COD_VOO;

SELECT ((SELECT COUNT(*) FROM Bagagens WHERE Bagagens.COD_VOO = Voo.COD_VOO)/Aviao.NUM_QTD_MAX_PASSAGEIROS)*100 
AS Percentual_Ocupação 
FROM Aviao, Voo
WHERE Voo.NOM_AVIAO = Aviao.NOM_AVIAO;
